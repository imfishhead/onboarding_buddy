<div class="max-w-3xl mx-auto p-6">
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-semibold">Chatbot</h1>
    <div class="text-sm text-gray-500">
      以 <span class="font-medium"><%= (params[:as] || User.first.email) %></span> 身份瀏覽
      <span class="ml-2">
        <%= link_to "Alice", my_chat_index_path(as: "alice@tsmc.com"), class: "underline" %> |
        <%= link_to "Bob",   my_chat_index_path(as: "bob@tsmc.com"),   class: "underline" %>
      </span>
    </div>
  </div>

  <div class="border rounded-xl p-4 bg-white mt-4 space-y-3">
    <% @messages.each do |m| %>
      <div class="<%= m.user? ? 'text-right' : 'text-left' %>">
        <div class="inline-block px-3 py-2 rounded-2xl <%= m.user? ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-800' %>">
          <%= simple_format h(m.content) %>
        </div>
        <% if m.meta.present? %>
          <div class="text-xs text-gray-500 mt-1 <%= m.user? ? 'text-right' : 'text-left' %>">
            <%= m.meta.slice("intent","topics").to_json %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
    <%= form_with url: my_chat_index_path, method: :post, class: "flex gap-2 items-center" do %>
      <%= hidden_field_tag :as, params[:as] %>
      <%= text_field_tag :q, nil, placeholder: "問我任何入職/生活問題，例如：通勤車怎麼申請？",
            class: "flex-1 border rounded-lg px-3 py-2" %>
      <%= submit_tag "送出", class: "px-4 py-2 bg-indigo-600 text-white rounded-lg" %>
    <% end %>
  </div>

  <div class="mt-6">
    <%= link_to "← 回 Onboarding", my_onboarding_path(as: params[:as]), class: "underline" %>
  </div>
</div>
