<div class="min-h-screen bg-gray-50">
  <header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b animate-slide-down">
    <div class="max-w-screen-sm mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-lg font-semibold tracking-tight">Chatbot</h1>
      <div class="text-xs text-gray-600">
        <span class="hidden sm:inline">以</span>
        <span class="font-medium"><%= (params[:as] || User.first.email) %></span>
        <span class="hidden sm:inline">身份瀏覽</span>
      </div>
    </div>
  </header>

  <main class="max-w-screen-sm mx-auto px-4 pt-4 pb-28">
    <section aria-label="messages" class="space-y-3">
      <% @messages.each_with_index do |m, idx| %>
        <div class="flex <%= m.user? ? 'justify-end' : 'justify-start' %> animate-fade-up" style="animation-delay: <%= (idx * 50) %>ms">
          <div class="max-w-[85%] rounded-2xl px-3 py-2 shadow-sm <%= m.user? ? 'bg-indigo-600 text-white rounded-br-sm' : 'bg-white text-gray-900 rounded-bl-sm border' %>">
            <div class="text-sm leading-relaxed">
              <%= simple_format h(m.content) %>
            </div>
            <% if m.meta.present? %>
              <div class="mt-1 text-[11px] <%= m.user? ? 'text-indigo-100/80' : 'text-gray-500' %>">
                <%= m.meta.slice("intent","topics").to_json %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </section>

    <section aria-label="demo-switch" class="mt-6 text-center text-xs text-gray-500">
      Demo 使用者：
      <%= link_to "Alice", my_chat_index_path(as: "alice@tsmc.com"), class: "underline" %>
      |
      <%= link_to "Bob", my_chat_index_path(as: "bob@tsmc.com"), class: "underline" %>
    </section>

    <section class="mt-6 text-center text-sm">
      <%= link_to "← 回 Onboarding", my_onboarding_path(as: params[:as]), class: "underline" %>
    </section>
  </main>

  <footer class="fixed inset-x-0 bottom-0 bg-white/95 backdrop-blur border-t">
    <div class="max-w-screen-sm mx-auto px-4 py-3">
      <%= form_with url: my_chat_index_path, method: :post, class: "flex items-center gap-2" do %>
        <%= hidden_field_tag :as, params[:as] %>
        <%= text_field_tag :q, nil, placeholder: "問我任何入職/生活問題，例如：通勤車怎麼申請？",
              class: "flex-1 border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
        <%= submit_tag "送出", class: "px-4 py-2 rounded-full bg-indigo-600 text-white text-sm shadow hover:bg-indigo-700 active:bg-indigo-800" %>
      <% end %>
      <div class="h-[env(safe-area-inset-bottom)]"></div>
    </div>
  </footer>
</div>
