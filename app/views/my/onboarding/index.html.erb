<%= render 'onboarding_tasks' %>
<%= render 'chat_content' %>
<%= render 'mood_content' %>

<!-- èƒ½é‡çƒå‹•ç•«å’Œ JavaScript -->
<script>
  // æäº¤å¿ƒæƒ…æ‰“å¡ - æå‰å®šç¾©ä»¥é¿å… ReferenceError
  function submitMoodCheckin(moodScore) {
    // ç«‹å³æ›´æ–°èƒ½é‡çƒè¦–è¦ºæ•ˆæœ
    if (typeof updateEnergyBall === 'function') {
      updateEnergyBall(moodScore);
    }
    
    // ç™¼é€ AJAX è«‹æ±‚åˆ°å¾Œç«¯
    fetch('/my/mood_checkins', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
      },
      body: JSON.stringify({
        score: moodScore,
        as: new URLSearchParams(window.location.search).get('as')
      })
    })
    .then(response => {
      if (response.ok) {
        // æˆåŠŸå¾Œé‡æ–°è¼‰å…¥é é¢ä»¥æ›´æ–°èƒ½é‡æ¢å’Œé¡¯ç¤ºåé¥‹
        window.location.reload();
      } else {
        console.error('å¿ƒæƒ…æ‰“å¡å¤±æ•—');
      }
    })
    .catch(error => {
      console.error('ç¶²è·¯éŒ¯èª¤:', error);
    });
  }
  // å¸¸é§èƒ½é‡çƒç³»çµ±
  document.addEventListener('DOMContentLoaded', function() {
    const energyBar = document.getElementById('energy-bar');
    const energyCard = document.getElementById('energy-card');
    const permanentEnergyBall = document.getElementById('permanent-energy-ball');
    
    // åˆå§‹åŒ–å¸¸é§èƒ½é‡çƒ
    let currentMoodScore = 3; // é è¨­ç‚ºæ™®é€šå¿ƒæƒ…
    
    // æª¢æŸ¥æ˜¯å¦éœ€è¦æ’­æ”¾å‹•ç•«
    const shouldAnimate = energyBar && (
      energyBar.dataset.animate === 'true' || 
      window.location.search.includes('mood_checked=true')
    );
    
    // æ·»åŠ æ¸¬è©¦æŒ‰éˆ•ï¼ˆé–‹ç™¼ç”¨ï¼‰
    if (energyCard && !document.getElementById('test-animation-container')) {
      const testContainer = document.createElement('div');
      testContainer.className = 'absolute top-2 right-2 flex flex-col gap-1';
      testContainer.id = 'test-animation-container';
      
      const moods = [
        { score: 1, emoji: 'ğŸ˜¢', label: 'å¾ˆç³Ÿ', color: 'bg-blue-500' },
        { score: 2, emoji: 'â˜¹ï¸', label: 'ä¸ä½³', color: 'bg-purple-500' },
        { score: 3, emoji: 'ğŸ˜', label: 'æ™®é€š', color: 'bg-green-500' },
        { score: 4, emoji: 'ğŸ™‚', label: 'ä¸éŒ¯', color: 'bg-orange-500' },
        { score: 5, emoji: 'ğŸ˜„', label: 'è¶…æ£’', color: 'bg-yellow-500' }
      ];
      
      moods.forEach(mood => {
        const testBtn = document.createElement('button');
        testBtn.innerHTML = `${mood.emoji}`;
        testBtn.className = `w-8 h-8 text-xs ${mood.color} text-white rounded hover:opacity-80 transition`;
        testBtn.title = `${mood.label} (${mood.score}åˆ†)`;
        testBtn.onclick = function() {
          updateEnergyBall(mood.score);
        };
        testContainer.appendChild(testBtn);
      });
      
      energyCard.appendChild(testContainer);
    }
    
    if (shouldAnimate) {
      triggerEnergyAnimation();
    }
    
    // å‰µå»ºå¸¸é§èƒ½é‡çƒ
    function createPermanentEnergyBall(moodScore = 3) {
      if (!permanentEnergyBall) return;
      
      // æ¸…ç©ºç¾æœ‰å…§å®¹
      permanentEnergyBall.innerHTML = '';
      
      // æ ¹æ“šå¿ƒæƒ…åˆ†æ•¸é¸æ“‡é¡è‰²æ–¹æ¡ˆ
      const colorSchemes = {
        1: { // å¾ˆç³Ÿ - æ·±è—è‰²ç³»
          colors: [
            { color: '#1e3a8a', radius: '18px', duration: '2.5s' },
            { color: '#3730a3', radius: '13px', duration: '5s' },
            { color: '#1e40af', radius: '15px', duration: '7.5s' },
            { color: '#3b82f6', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #60a5fa 0%, #3b82f6 50%, transparent 100%)'
        },
        2: { // ä¸ä½³ - ç´«è‰²ç³»
          colors: [
            { color: '#581c87', radius: '18px', duration: '2.5s' },
            { color: '#7c3aed', radius: '13px', duration: '5s' },
            { color: '#8b5cf6', radius: '15px', duration: '7.5s' },
            { color: '#a78bfa', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #c4b5fd 0%, #8b5cf6 50%, transparent 100%)'
        },
        3: { // æ™®é€š - ç¶ è‰²ç³»
          colors: [
            { color: '#166534', radius: '18px', duration: '2.5s' },
            { color: '#16a34a', radius: '13px', duration: '5s' },
            { color: '#22c55e', radius: '15px', duration: '7.5s' },
            { color: '#4ade80', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #86efac 0%, #22c55e 50%, transparent 100%)'
        },
        4: { // ä¸éŒ¯ - æ©™è‰²ç³»
          colors: [
            { color: '#ea580c', radius: '18px', duration: '2.5s' },
            { color: '#f97316', radius: '13px', duration: '5s' },
            { color: '#fb923c', radius: '15px', duration: '7.5s' },
            { color: '#fdba74', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #fed7aa 0%, #fb923c 50%, transparent 100%)'
        },
        5: { // è¶…æ£’ - é‡‘é»ƒè‰²ç³»
          colors: [
            { color: '#fbbf24', radius: '18px', duration: '2.5s' },
            { color: '#f59e0b', radius: '13px', duration: '5s' },
            { color: '#eab308', radius: '15px', duration: '7.5s' },
            { color: '#fde047', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #fef3c7 0%, #fbbf24 50%, transparent 100%)'
        }
      };
      
      const scheme = colorSchemes[moodScore] || colorSchemes[3];
      
      // å‰µå»ºæ—‹è½‰çš„å…‰çƒ
      scheme.colors.forEach((config, index) => {
        const energySpan = document.createElement('span');
        energySpan.style.position = 'absolute';
        energySpan.style.width = `calc(80px + ${config.radius})`;
        energySpan.style.height = `calc(80px + ${config.radius})`;
        energySpan.style.background = config.color;
        energySpan.style.borderRadius = '50%';
        energySpan.style.transformOrigin = `calc(40px + ${config.radius})`;
        energySpan.style.animation = `energyRotate ${config.duration} linear infinite`;
        energySpan.style.mixBlendMode = 'plus-lighter';
        energySpan.style.filter = 'blur(12px)';
        energySpan.style.opacity = '0.6';
        
        // å¶æ•¸å…ƒç´ åå‘æ—‹è½‰
        if (index % 2 === 1) {
          energySpan.style.animationDirection = 'reverse';
        }
        
        permanentEnergyBall.appendChild(energySpan);
      });
      
      // ä¸­å¿ƒç™¼å…‰é»
      const centerGlow = document.createElement('div');
      centerGlow.style.position = 'absolute';
      centerGlow.style.left = '50%';
      centerGlow.style.top = '50%';
      centerGlow.style.transform = 'translate(-50%, -50%)';
      centerGlow.style.width = '16px';
      centerGlow.style.height = '16px';
      centerGlow.style.background = scheme.centerGlow;
      centerGlow.style.borderRadius = '50%';
      centerGlow.style.filter = 'blur(4px)';
      centerGlow.style.animation = 'energyPulse 2s ease-in-out infinite alternate';
      permanentEnergyBall.appendChild(centerGlow);
    }
    
    // æ›´æ–°èƒ½é‡çƒé¡è‰² - æ¼¸è®Šæ•ˆæœ
    function updateEnergyBall(moodScore) {
      const targetScore = moodScore;
      
      // æ¼¸è®Šåˆ°ç›®æ¨™å¿ƒæƒ…
      animateToMood(targetScore);
      
      // åŒæ™‚æ›´æ–°èƒ½é‡æ¢é¡è‰²
      if (energyBar) {
        const colorSchemes = {
          1: 'linear-gradient(to right, #1e40af, #3b82f6, #1e40af)',
          2: 'linear-gradient(to right, #7c3aed, #a78bfa, #7c3aed)',
          3: 'linear-gradient(to right, #16a34a, #4ade80, #16a34a)',
          4: 'linear-gradient(to right, #f97316, #fdba74, #f97316)',
          5: 'linear-gradient(to right, #f59e0b, #fde047, #f59e0b)'
        };
        
        const newGradient = colorSchemes[moodScore] || colorSchemes[3];
        energyBar.style.background = newGradient;
        energyBar.style.transition = 'background 1.5s ease-in-out';
      }
    }
    
    // æ¼¸è®Šå‹•ç•«åˆ°ç›®æ¨™å¿ƒæƒ…
    function animateToMood(targetScore) {
      const steps = Math.abs(targetScore - currentMoodScore);
      const duration = 1500; // 1.5ç§’ç¸½å‹•ç•«æ™‚é–“
      const stepDuration = duration / (steps + 1);
      
      let currentStep = 0;
      
      function nextStep() {
        if (currentStep <= steps) {
          const progress = currentStep / (steps + 1);
          const intermediateScore = Math.round(currentMoodScore + (targetScore - currentMoodScore) * progress);
          
          // å‰µå»ºéæ¸¡æ•ˆæœçš„èƒ½é‡çƒ
          createTransitionEnergyBall(intermediateScore, progress);
          
          currentStep++;
          setTimeout(nextStep, stepDuration);
        } else {
          // æœ€çµ‚ç‹€æ…‹
          currentMoodScore = targetScore;
          createPermanentEnergyBall(targetScore);
          
          // æ·»åŠ ã€Œé¤Šæˆã€æ•ˆæœ
          addNurturingEffect(targetScore);
        }
      }
      
      nextStep();
    }
    
    // å‰µå»ºéæ¸¡æ•ˆæœçš„èƒ½é‡çƒ
    function createTransitionEnergyBall(score, progress) {
      if (!permanentEnergyBall) return;
      
      // æ¸…ç©ºç¾æœ‰å…§å®¹
      permanentEnergyBall.innerHTML = '';
      
      const colorSchemes = {
        1: { colors: [
          { color: '#1e3a8a', radius: '18px', duration: '2.5s' },
          { color: '#3730a3', radius: '13px', duration: '5s' },
          { color: '#1e40af', radius: '15px', duration: '7.5s' },
          { color: '#3b82f6', radius: '20px', duration: '10s' }
        ], centerGlow: 'radial-gradient(circle, #60a5fa 0%, #3b82f6 50%, transparent 100%)' },
        2: { colors: [
          { color: '#581c87', radius: '18px', duration: '2.5s' },
          { color: '#7c3aed', radius: '13px', duration: '5s' },
          { color: '#8b5cf6', radius: '15px', duration: '7.5s' },
          { color: '#a78bfa', radius: '20px', duration: '10s' }
        ], centerGlow: 'radial-gradient(circle, #c4b5fd 0%, #8b5cf6 50%, transparent 100%)' },
        3: { colors: [
          { color: '#166534', radius: '18px', duration: '2.5s' },
          { color: '#16a34a', radius: '13px', duration: '5s' },
          { color: '#22c55e', radius: '15px', duration: '7.5s' },
          { color: '#4ade80', radius: '20px', duration: '10s' }
        ], centerGlow: 'radial-gradient(circle, #86efac 0%, #22c55e 50%, transparent 100%)' },
        4: { colors: [
          { color: '#ea580c', radius: '18px', duration: '2.5s' },
          { color: '#f97316', radius: '13px', duration: '5s' },
          { color: '#fb923c', radius: '15px', duration: '7.5s' },
          { color: '#fdba74', radius: '20px', duration: '10s' }
        ], centerGlow: 'radial-gradient(circle, #fed7aa 0%, #fb923c 50%, transparent 100%)' },
        5: { colors: [
          { color: '#fbbf24', radius: '18px', duration: '2.5s' },
          { color: '#f59e0b', radius: '13px', duration: '5s' },
          { color: '#eab308', radius: '15px', duration: '7.5s' },
          { color: '#fde047', radius: '20px', duration: '10s' }
        ], centerGlow: 'radial-gradient(circle, #fef3c7 0%, #fbbf24 50%, transparent 100%)' }
      };
      
      const scheme = colorSchemes[score] || colorSchemes[3];
      
      // æ ¹æ“šé€²åº¦èª¿æ•´é€æ˜åº¦å’Œå¤§å°
      const opacity = 0.4 + (progress * 0.4); // 0.4 åˆ° 0.8
      const scale = 0.8 + (progress * 0.2); // 0.8 åˆ° 1.0
      
      // å‰µå»ºæ—‹è½‰çš„å…‰çƒ
      scheme.colors.forEach((config, index) => {
        const energySpan = document.createElement('span');
        energySpan.style.position = 'absolute';
        energySpan.style.width = `calc(${80 * scale}px + ${config.radius})`;
        energySpan.style.height = `calc(${80 * scale}px + ${config.radius})`;
        energySpan.style.background = config.color;
        energySpan.style.borderRadius = '50%';
        energySpan.style.transformOrigin = `calc(${40 * scale}px + ${config.radius})`;
        energySpan.style.animation = `energyRotate ${config.duration} linear infinite`;
        energySpan.style.mixBlendMode = 'plus-lighter';
        energySpan.style.filter = 'blur(12px)';
        energySpan.style.opacity = opacity;
        energySpan.style.transition = 'all 0.3s ease-in-out';
        
        // å¶æ•¸å…ƒç´ åå‘æ—‹è½‰
        if (index % 2 === 1) {
          energySpan.style.animationDirection = 'reverse';
        }
        
        permanentEnergyBall.appendChild(energySpan);
      });
      
      // ä¸­å¿ƒç™¼å…‰é»
      const centerGlow = document.createElement('div');
      centerGlow.style.position = 'absolute';
      centerGlow.style.left = '50%';
      centerGlow.style.top = '50%';
      centerGlow.style.transform = 'translate(-50%, -50%)';
      centerGlow.style.width = `${16 * scale}px`;
      centerGlow.style.height = `${16 * scale}px`;
      centerGlow.style.background = scheme.centerGlow;
      centerGlow.style.borderRadius = '50%';
      centerGlow.style.filter = 'blur(4px)';
      centerGlow.style.animation = 'energyPulse 2s ease-in-out infinite alternate';
      centerGlow.style.transition = 'all 0.3s ease-in-out';
      permanentEnergyBall.appendChild(centerGlow);
    }
    
    // æ·»åŠ ã€Œé¤Šæˆã€æ•ˆæœ
    function addNurturingEffect(score) {
      if (!permanentEnergyBall) return;
      
      // æ ¹æ“šå¿ƒæƒ…åˆ†æ•¸æ·»åŠ ä¸åŒçš„é¤Šæˆæ•ˆæœ
      const nurturingEffects = {
        1: { emoji: 'ğŸ’™', message: 'èƒ½é‡çƒæ„Ÿå—åˆ°ä½ çš„é—œæ‡·ï¼Œæ­£åœ¨æ…¢æ…¢æ¢å¾©...', color: '#3b82f6' },
        2: { emoji: 'ğŸ’œ', message: 'èƒ½é‡çƒé–‹å§‹ç™¼å…‰ï¼Œä½ çš„é™ªä¼´è®“å®ƒæ„Ÿåˆ°æº«æš–', color: '#8b5cf6' },
        3: { emoji: 'ğŸ’š', message: 'èƒ½é‡çƒç©©å®šæˆé•·ï¼Œä¿æŒé€™å€‹ç¯€å¥ï¼', color: '#22c55e' },
        4: { emoji: 'ğŸ§¡', message: 'èƒ½é‡çƒå……æ»¿æ´»åŠ›ï¼Œä½ çš„æ­£èƒ½é‡æ„ŸæŸ“äº†å®ƒï¼', color: '#fb923c' },
        5: { emoji: 'ğŸ’›', message: 'èƒ½é‡çƒé–ƒé–ƒç™¼å…‰ï¼Œä½ å€‘çš„é€£çµè¶Šä¾†è¶Šå¼·ï¼', color: '#fbbf24' }
      };
      
      const effect = nurturingEffects[score] || nurturingEffects[3];
      
      // å‰µå»ºé¤Šæˆæç¤º
      const nurturingTip = document.createElement('div');
      nurturingTip.style.position = 'absolute';
      nurturingTip.style.top = '-40px';
      nurturingTip.style.left = '50%';
      nurturingTip.style.transform = 'translateX(-50%)';
      nurturingTip.style.background = 'rgba(255, 255, 255, 0.95)';
      nurturingTip.style.padding = '8px 12px';
      nurturingTip.style.borderRadius = '20px';
      nurturingTip.style.fontSize = '12px';
      nurturingTip.style.color = effect.color;
      nurturingTip.style.fontWeight = '500';
      nurturingTip.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
      nurturingTip.style.border = `2px solid ${effect.color}20`;
      nurturingTip.style.animation = 'fadeInUp 0.5s ease-out';
      nurturingTip.innerHTML = `${effect.emoji} ${effect.message}`;
      
      permanentEnergyBall.appendChild(nurturingTip);
      
      // 3ç§’å¾Œç§»é™¤æç¤º
      setTimeout(() => {
        if (nurturingTip.parentNode) {
          nurturingTip.style.animation = 'fadeOutUp 0.5s ease-in forwards';
          setTimeout(() => nurturingTip.remove(), 500);
        }
      }, 3000);
      
      // æ·»åŠ èƒ½é‡çƒã€Œé–‹å¿ƒã€çš„å‹•ç•«
      const energySpans = permanentEnergyBall.querySelectorAll('span');
      energySpans.forEach((span, index) => {
        setTimeout(() => {
          span.style.animation = `energyHappy 0.8s ease-in-out ${index * 0.1}s`;
        }, 100);
      });
    }
    
    // å°‡å‡½æ•¸è¨­ç‚ºå…¨åŸŸï¼Œä¾›æŒ‰éˆ•èª¿ç”¨
    window.updateEnergyBall = updateEnergyBall;
    
    // åˆå§‹åŒ–å¸¸é§èƒ½é‡çƒ
    createPermanentEnergyBall(currentMoodScore);
    
    function triggerEnergyAnimation(moodScore = null) {
      if (!energyBar || !energyCard) return;
      
      // æ ¹æ“šå¿ƒæƒ…åˆ†æ•¸é¸æ“‡é¡è‰²æ–¹æ¡ˆ
      const colorSchemes = {
        1: { // å¾ˆç³Ÿ - æ·±è—è‰²ç³»ï¼ˆå†·éœã€æ²‰ç©©ï¼‰
          colors: [
            { color: '#1e3a8a', radius: '18px', duration: '2.5s' },
            { color: '#3730a3', radius: '13px', duration: '5s' },
            { color: '#1e40af', radius: '15px', duration: '7.5s' },
            { color: '#3b82f6', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #60a5fa 0%, #3b82f6 50%, transparent 100%)',
          energyBar: 'linear-gradient(to right, #1e40af, #3b82f6, #1e40af)'
        },
        2: { // ä¸ä½³ - ç´«è‰²ç³»ï¼ˆç¥ç§˜ã€å…§çœï¼‰
          colors: [
            { color: '#581c87', radius: '18px', duration: '2.5s' },
            { color: '#7c3aed', radius: '13px', duration: '5s' },
            { color: '#8b5cf6', radius: '15px', duration: '7.5s' },
            { color: '#a78bfa', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #c4b5fd 0%, #8b5cf6 50%, transparent 100%)',
          energyBar: 'linear-gradient(to right, #7c3aed, #a78bfa, #7c3aed)'
        },
        3: { // æ™®é€š - ç¶ è‰²ç³»ï¼ˆå¹³è¡¡ã€è‡ªç„¶ï¼‰
          colors: [
            { color: '#166534', radius: '18px', duration: '2.5s' },
            { color: '#16a34a', radius: '13px', duration: '5s' },
            { color: '#22c55e', radius: '15px', duration: '7.5s' },
            { color: '#4ade80', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #86efac 0%, #22c55e 50%, transparent 100%)',
          energyBar: 'linear-gradient(to right, #16a34a, #4ade80, #16a34a)'
        },
        4: { // ä¸éŒ¯ - æ©™è‰²ç³»ï¼ˆæº«æš–ã€æ´»åŠ›ï¼‰
          colors: [
            { color: '#ea580c', radius: '18px', duration: '2.5s' },
            { color: '#f97316', radius: '13px', duration: '5s' },
            { color: '#fb923c', radius: '15px', duration: '7.5s' },
            { color: '#fdba74', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #fed7aa 0%, #fb923c 50%, transparent 100%)',
          energyBar: 'linear-gradient(to right, #f97316, #fdba74, #f97316)'
        },
        5: { // è¶…æ£’ - é‡‘é»ƒè‰²ç³»ï¼ˆå¿«æ¨‚ã€èƒ½é‡ï¼‰
          colors: [
            { color: '#fbbf24', radius: '18px', duration: '2.5s' },
            { color: '#f59e0b', radius: '13px', duration: '5s' },
            { color: '#eab308', radius: '15px', duration: '7.5s' },
            { color: '#fde047', radius: '20px', duration: '10s' }
          ],
          centerGlow: 'radial-gradient(circle, #fef3c7 0%, #fbbf24 50%, transparent 100%)',
          energyBar: 'linear-gradient(to right, #f59e0b, #fde047, #f59e0b)'
        }
      };
      
      // å¦‚æœæ²’æœ‰æŒ‡å®šå¿ƒæƒ…åˆ†æ•¸ï¼Œä½¿ç”¨é è¨­çš„ç¶ è‰²ç³»
      const scheme = colorSchemes[moodScore] || colorSchemes[3];
      
      // 1. èƒ½é‡çƒäº®èµ·å‹•ç•«
      setTimeout(() => {
        energyBar.style.transform = 'scale(1.1)';
        energyBar.style.boxShadow = `0 0 25px ${scheme.colors[0].color}80, 0 0 50px ${scheme.colors[1].color}40`;
        energyBar.style.background = scheme.energyBar;
        
        // æ·»åŠ è„ˆå‹•æ•ˆæœ
        energyBar.style.animation = 'energyPulse 0.6s ease-in-out';
        
        setTimeout(() => {
          energyBar.style.transform = 'scale(1)';
          energyBar.style.boxShadow = `0 0 0 1px ${scheme.colors[0].color}15`;
          energyBar.style.background = scheme.energyBar;
          energyBar.style.animation = '';
        }, 600);
      }, 300);
      
      // 2. æ›´æ–°å¸¸é§èƒ½é‡çƒé¡è‰²
      setTimeout(() => {
        if (moodScore) {
          updateEnergyBall(moodScore);
        }
      }, 500);
      
      // 3. èƒ½é‡ç²’å­æ•ˆæœ
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'absolute w-1 h-1 bg-emerald-400 rounded-full';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.top = Math.random() * 100 + '%';
          particle.style.animation = 'particleFloat 1.5s ease-out forwards';
          particle.style.zIndex = '10';
          energyCard.appendChild(particle);
          
          setTimeout(() => particle.remove(), 1500);
        }, i * 80);
      }
      
      // 4. æˆåŠŸéŸ³æ•ˆæç¤ºï¼ˆè¦–è¦ºï¼‰
      setTimeout(() => {
        const successIcon = document.createElement('div');
        successIcon.innerHTML = 'âœ¨';
        successIcon.style.position = 'absolute';
        successIcon.style.left = '50%';
        successIcon.style.top = '50%';
        successIcon.style.transform = 'translate(-50%, -50%)';
        successIcon.style.fontSize = '24px';
        successIcon.style.animation = 'successPop 0.8s ease-out';
        successIcon.style.zIndex = '15';
        energyCard.appendChild(successIcon);
        
        setTimeout(() => successIcon.remove(), 800);
      }, 800);
    }
  });
</script>

<style>
  @keyframes energyPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  
  @keyframes energyRotate {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  
  @keyframes energyBallAppear {
    0% { 
      transform: scale(0) rotate(-180deg);
      opacity: 0;
    }
    50% { 
      transform: scale(1.3) rotate(-90deg);
      opacity: 1;
    }
    100% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }
  }
  
  @keyframes particleFloat {
    0% { 
      transform: translateY(0) scale(0);
      opacity: 1;
    }
    50% { 
      transform: translateY(-20px) scale(1);
      opacity: 0.8;
    }
    100% { 
      transform: translateY(-40px) scale(0);
      opacity: 0;
    }
  }
  
  @keyframes successPop {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.3);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 0;
    }
  }
  
  @keyframes fadeInUp {
    0% { 
      transform: translateX(-50%) translateY(10px);
      opacity: 0;
    }
    100% { 
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  }
  
  @keyframes fadeOutUp {
    0% { 
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    100% { 
      transform: translateX(-50%) translateY(-10px);
      opacity: 0;
    }
  }
  
  @keyframes energyHappy {
    0% { 
      transform: scale(1) rotate(0deg);
    }
    25% { 
      transform: scale(1.1) rotate(5deg);
    }
    50% { 
      transform: scale(1.2) rotate(-5deg);
    }
    75% { 
      transform: scale(1.1) rotate(3deg);
    }
    100% { 
      transform: scale(1) rotate(0deg);
    }
  }
</style>